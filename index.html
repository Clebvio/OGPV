<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Solar Resource Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
    .info { position: absolute; bottom: 20px; left: 10px; background: white; padding: 6px 12px; border-radius: 4px; font-size: 14px; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="info" id="info">Hover over the map to see solar irradiance...</div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/geotiff"></script>
  <script src="https://unpkg.com/plotty"></script>
  <script src="https://unpkg.com/leaflet-geotiff"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

  <script>
    const map = L.map('map').setView([39.5, -98.35], 5);

    // Base Map
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Info box
    const info = document.getElementById('info');

    // Load the GeoTIFF
    let geoTiffLayer = new L.LeafletGeotiff('irri.tif', {
      band: 0,
      name: 'Solar Irradiance',
      displayMin: 0,
      displayMax: 1000,
      colorScale: 'viridis',
      clampLow: false,
      clampHigh: false,
      renderer: new L.LeafletGeotiff.Plotty({ colorScale: 'viridis' }),
      onPixelValue: function (val) {
        // Optional: you can modify how pixel values are displayed
      }
    }).addTo(map);

    // Show irradiance on click
    map.on('click', function (e) {
      const latlng = e.latlng;
      const value = geoTiffLayer.getValueAtLatLng(latlng.lat, latlng.lng);
      if (value !== null) {
        info.innerHTML = `Solar Irradiance: <strong>${value.toFixed(2)} W/mÂ²</strong> @ (${latlng.lat.toFixed(4)}, ${latlng.lng.toFixed(4)})`;
      } else {
        info.innerHTML = "No data at this location.";
      }
    });

    // Also show irradiance on hover
    map.on('mousemove', function (e) {
      const value = geoTiffLayer.getValueAtLatLng(e.latlng.lat, e.latlng.lng);
      if (value !== null) {
        info.innerHTML = `Solar Irradiance: <strong>${value.toFixed(2)} W/mÂ²</strong>`;
      } else {
        info.innerHTML = "No data here...";
      }
    });

    // Geocoder for address search
    L.Control.geocoder({
      defaultMarkGeocode: true
    })
    .on('markgeocode', function(e) {
      const bbox = e.geocode.bbox;
      const center = e.geocode.center;
      map.setView(center, 13);
    })
    .addTo(map);

    // ðŸ”§ Your customer homes (example markers, you can expand this)
    const customers = [
      { name: "Customer A", lat: 34.0522, lng: -118.2437 }, // LA
      { name: "Customer B", lat: 36.7783, lng: -119.4179 }, // Fresno
      { name: "Customer C", lat: 37.7749, lng: -122.4194 }  // SF
    ];

    customers.forEach(c => {
      L.marker([c.lat, c.lng])
        .addTo(map)
        .bindPopup(`<strong>${c.name}</strong>`);
    });
  </script>
</body>
</html>


